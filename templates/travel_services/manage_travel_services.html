{% extends "base.html" %} {% block title %}Manage Travel Services{% endblock %}
{% block content %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/manage_travel_services.css') }}"
/>

<div class="container">
  <h2>Manage Travel Services</h2>

  <button id="add-service-btn">Add New Service</button>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Destination</th>
        <th>Price</th>
        <th>Rating</th>
        <th>Flight</th>
        <th>Hotel</th>
        <th>Tour</th>
        <th>Max Travelers</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for service in services %}
      <tr id="service-{{ service['service_id'] }}">
        <td>{{ service['service_id'] }}</td>
        <td>{{ service['title'] }}</td>
        <td>{{ service['destination'] }}</td>
        <td>{{ service['price'] }}</td>
        <td>{{ service['rating'] or 'N/A' }}</td>
        <td>{{ service['flight'] or '-' }}</td>
        <td>{{ service['hotel'] or '-' }}</td>
        <td>{{ service['tour'] or '-' }}</td>
        <td>{{ service['max_travelers'] or '-' }}</td>
        <td>
          <button
            class="action-btn edit-btn"
            onclick="editService('{{ service['service_id'] }}')"
          >
            Edit
          </button>
          <button
            class="action-btn delete-btn"
            onclick="deleteService('{{ service['service_id'] }}')"
          >
            Delete
          </button>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="10" style="text-align: center">No services available.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="serviceModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h3 id="modalTitle">Add New Service</h3>
    <form
      id="serviceForm"
      method="POST"
      action="{{ url_for('add_travel_service') }}"
    >
      <input type="hidden" name="service_id" id="service_id" />
      <label>Title</label>
      <input type="text" name="title" id="title" required />
      <label>Destination</label>
      <input type="text" name="destination" id="destination" />
      <label>Price</label>
      <input type="number" name="price" id="price" step="0.01" required />
      <label>Rating</label>
      <input
        type="number"
        name="rating"
        id="rating"
        min="0"
        max="5"
        step="0.5"
      />
      <label>Flight</label>
      <input type="text" name="flight" id="flight" />
      <label>Hotel</label>
      <input type="text" name="hotel" id="hotel" />
      <label>Tour</label>
      <input type="text" name="tour" id="tour" />
      <label>Max Travelers</label>
      <input type="number" name="max_travelers" id="max_travelers" />
      <button type="submit" style="margin-top: 15px">Save</button>
    </form>
  </div>
</div>

<script>
  const modal = document.getElementById("serviceModal");
  const btn = document.getElementById("add-service-btn");
  const span = document.getElementsByClassName("close")[0];

  // Open add modal
  btn.onclick = function () {
    document.getElementById("modalTitle").innerText = "Add New Service";
    document.getElementById("serviceForm").action =
      "{{ url_for('add_travel_service') }}";
    document.getElementById("serviceForm").reset();
    document.getElementById("service_id").value = "";
    modal.style.display = "block";
  };

  // Close modal
  span.onclick = function () {
    modal.style.display = "none";
  };

  window.onclick = function (event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  };

  function editService(id) {
    // Lấy hàng từ bảng bằng ID
    const row = document.getElementById("service-" + id);
    if (!row) {
      console.error("Row with ID 'service-" + id + "' not found.");
      return;
    }

    // Đặt tiêu đề và action của form
    document.getElementById("modalTitle").innerText = "Edit Service";
    document.getElementById("serviceForm").action =
      "/edit_travel_service/" + id;

    // Gán các giá trị từ hàng bảng vào form
    document.getElementById("service_id").value = id;
    document.getElementById("title").value = row.children[1].innerText;
    document.getElementById("destination").value = row.children[2].innerText;
    document.getElementById("price").value = parseFloat(
      row.children[3].innerText
    ); // Chuyển đổi sang số
    document.getElementById("rating").value =
      row.children[4].innerText !== "N/A"
        ? parseFloat(row.children[4].innerText)
        : "";
    document.getElementById("flight").value =
      row.children[5].innerText !== "-" ? row.children[5].innerText : "";
    document.getElementById("hotel").value =
      row.children[6].innerText !== "-" ? row.children[6].innerText : "";
    document.getElementById("tour").value =
      row.children[7].innerText !== "-" ? row.children[7].innerText : "";
    document.getElementById("max_travelers").value =
      row.children[8].innerText !== "-"
        ? parseInt(row.children[8].innerText)
        : ""; // Chuyển đổi sang số nguyên

    // Hiển thị modal
    modal.style.display = "block";
  }

  function deleteService(id) {
    if (confirm("Bạn có chắc chắn muốn xóa dịch vụ này không?")) {
      window.location.href = `/delete_travel_service/${id}`;
    }
  }
</script>
{% endblock %}
